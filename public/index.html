<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>XO AI</title>

<!-- Tailwind + Typography -->
<script src="https://cdn.tailwindcss.com?plugins=typography"></script>

<!-- Google Fonts Inter variable -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

<style>
:root{color-scheme:dark}
html{font-family:"Inter",ui-sans-serif,system-ui}
body{background:#0f0f10;color:#e5e5e5;margin:0}

@keyframes pulse{0%,100%{opacity:.4}50%{opacity:1}}
.badge-pulse{animation:pulse 2s ease-in-out infinite}

@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.animate-fadeIn{animation:fadeIn .25s ease}

/* @keyframes rotate{to{transform:rotate(360deg)}}
.loader{animation:rotate 1s linear infinite} */
.abs{position:absolute;inset:0;opacity:0}
@keyframes fadeCycle{
  0%{opacity:1}30%{opacity:1}40%{opacity:0}100%{opacity:0}
}
#icon1{animation:fadeCycle 3s linear infinite}
#icon2{animation:fadeCycle 3s linear infinite 1s}
#icon3{animation:fadeCycle 3s linear infinite 2s}

</style>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body class="flex flex-col min-h-screen">

<!-- ───── Splash / loading overlay  ───── -->
<div id="splash" class="fixed inset-0 flex flex-col items-center justify-center gap-4 bg-[#0f0f10] z-50">
  <div class="relative w-14 h-14">
    <!-- ikon-ikon ditumpuk & dianimasikan -->
    <svg id="icon1" xmlns="http://www.w3.org/2000/svg" class="abs w-full h-full text-purple-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>
    <svg id="icon2" xmlns="http://www.w3.org/2000/svg" class="abs w-full h-full text-purple-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"/><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"/><path d="M3.477 10.896a4 4 0 0 1 .585-.396"/><path d="M19.938 10.5a4 4 0 0 1 .585.396"/><path d="M6 18a4 4 0 0 1-1.967-.516"/><path d="M19.967 17.484A4 4 0 0 1 18 18"/></svg>
    <svg id="icon3" xmlns="http://www.w3.org/2000/svg" class="abs w-full h-full text-purple-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z"/><path d="m9 12 2 2 4-4"/></svg>
  <h1 class="text-xl font-semibold">XO&nbsp;AI</h1>
  <span class="text-sm text-neutral-400">Memuat Data&hellip;</span>
</div>

<header class="border-b border-neutral-800 p-4 flex items-center gap-3">
  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-purple-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>
  <h1 class="text-lg font-semibold tracking-wide">XO&nbsp;AI</h1>
  <span class="text-[10px] uppercase bg-purple-600/30 px-2 py-0.5 rounded-md badge-pulse">release v1.0</span>
</header>

<main id="chatArea" class="flex-1 overflow-y-auto p-4 flex flex-col gap-4"></main>

<form id="chatForm" class="border-t border-neutral-800 p-3 flex items-center gap-2 bg-neutral-900/60 backdrop-blur-md">
  <input id="userInput" autocomplete="off" placeholder="Ketik pesan…"
         class="flex-1 bg-neutral-800/70 text-sm px-4 py-2 rounded-full focus:outline-none focus:ring focus:ring-purple-600/50"/>
  <button class="bg-purple-600 hover:bg-purple-500 active:bg-purple-700 transition-colors text-white rounded-full p-2" aria-label="Kirim">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2"
         stroke-linecap="round" stroke-linejoin="round"><path d="M22 2 11 13"/><path d="m22 2-7 20-4-9-9-4 20-7z"/></svg>
  </button>
</form>

<script>
const chatArea=document.getElementById('chatArea');

function botAvatar(){
  return `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-purple-400 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>`;
}

function addMsg(text,from){
  const wrap=document.createElement('div');
  wrap.className='flex gap-2 items-start max-w-prose';
  // bubble
  const bubble=document.createElement('div');
  bubble.className=`prose prose-invert max-w-none px-4 py-3 rounded-2xl animate-fadeIn ${
      from==='user'?'self-end bg-purple-600 text-white':'bg-neutral-800'
    }`;
  bubble.innerHTML=marked.parse(text);
  if(from==='bot'){
    const avatar=document.createElement('div');
    avatar.innerHTML=botAvatar();
    wrap.appendChild(avatar);
    // label
    const label=document.createElement('span');
    label.textContent='XO AI';
    label.className='block text-[10px] uppercase text-purple-400 mt-0.5';
    bubble.prepend(label);
  }else{
    wrap.classList.add('self-end');
  }
  wrap.appendChild(bubble);
  chatArea.appendChild(wrap);
  chatArea.scrollTop=chatArea.scrollHeight;
  return bubble;
}

function typing(el,dur=2500){
  const frames=['●','●●','●●●'];
  let i=0;
  return new Promise(r=>{
    const iv=setInterval(()=>{el.textContent=frames[i];i=(i+1)%frames.length;},400);
    setTimeout(()=>{clearInterval(iv);r();},dur);
  });
}

async function ask(prompt){
  const res=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({prompt})});
  const data=await res.json();
  return res.ok?data.answer:`Error: ${data.error}`;
}

document.getElementById('chatForm').addEventListener('submit',async e=>{
  e.preventDefault();
  const q=document.getElementById('userInput').value.trim();
  if(!q) return;
  addMsg(q,'user');
  e.target.reset();

  const hold=addMsg('', 'bot');
  await typing(hold,2500);
  hold.innerHTML=marked.parse(await ask(q));
});

/* Splash & sambutan */
window.addEventListener('load',()=>{
  setTimeout(()=>{
    document.getElementById('splash').classList.add('hidden');
    // greeting
    addMsg('Halo! 👋<br/>Saya <strong>XO AI</strong>. Ada yang bisa saya bantu hari ini?','bot');
  },5000);
});
</script>
</body>
</html>
